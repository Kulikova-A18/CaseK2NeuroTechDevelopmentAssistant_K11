from typing import Dict, Any, List


# =========================
# DAILY
# =========================

def build_daily_initial_prompt(raw_text: str) -> str:
    return f"""
Ответ разработчика на daily:

\"\"\"
{raw_text}
\"\"\"

Разбери этот текст согласно инструкциям.
"""


def build_daily_clarification_prompt(
    previous_json: Dict[str, Any],
    clarification_text: str
) -> str:
    return f"""
Исходный daily JSON:
{previous_json}

Уточнение от разработчика:
\"\"\"
{clarification_text}
\"\"\"

Обнови JSON, сохранив структуру.
"""


# =========================
# FAQ
# =========================


def build_faq_answer_prompt(question: str, context: str | None = None) -> str:
    if context:
        return f"""
Контекст:
{context}

Вопрос:
{question}
"""
    return f"""
Вопрос:
{question}
"""


# =========================
# ANALYTICS
# =========================

def build_analytics_intent_prompt(message: str) -> str:
    return f"""
Запрос пользователя:
\"\"\"
{message}
\"\"\"

Определи аналитический интент.
"""


def build_analytics_report_prompt(metrics: Dict[str, Any]) -> str:
    return f"""
Тебе передали структурированные метрики спринта команды разработки.

Метрики:
{metrics}

Сформируй КОРОТКИЙ, ЧЁТКИЙ аналитический отчёт для тимлида и продакта.

Требования к отчёту:
1. Пиши деловым, нейтральным тоном.
2. Используй списки и короткие абзацы.
3. Не пиши вводных фраз и лишних пояснений.
4. Отчёт должен читаться за 1–2 минуты.

Структура отчёта (строго придерживайся):

1. **Общий статус**
   - Кратко: в графике / под риском / критично.
   - 1–2 предложения.

2. **Прогресс спринта**
   - Процент выполненных задач.
   - Закрытые ключевые цели / фичи.
   - Что ещё в работе.

3. **Риски и блокеры**
   - Топ-3 риска (если есть).
   - Критичные блокеры с коротким описанием.
   - Укажи, если рисков нет.

4. **Загрузка команды**
   - Кто перегружен.
   - Кто недозагружен (если применимо).

5. **Прогноз**
   - Вероятность завершения спринта в срок.
   - Если есть риск срыва — кратко почему.

Пиши ТОЛЬКО сам отчёт. Без markdown-заголовков верхнего уровня.
"""


# =========================
# BLOCKERS
# =========================

def build_blockers_prompt(blockers: List[Dict[str, Any]]) -> str:
    return f"""
Список блокеров:
{blockers}

Классифицируй блокеры и оцени критичность.
"""


# =========================
# DIGEST
# =========================

def build_team_digest_prompt(data: Dict[str, Any]) -> str:
    return f"""
Тебе передали агрегированные данные по команде за текущий спринт.

Данные:
{data}

Сформируй КОРОТКИЙ командный дайджест для тимлида.

Требования:
1. Максимум 8–12 строк текста.
2. Пиши простым, деловым языком.
3. Без воды и мотивационных фраз.
4. Акцент на факты и проблемы.

Структура дайджеста:

- **Статус команды:** кратко (в графике / под риском / критично).
- **Что продвинулось:** 2–4 ключевых пункта.
- **Блокеры и проблемы:** только если есть.
- **Риски:** если что-то может повлиять на сроки.
- **Фокус на сегодня / ближайшие дни:** 1–2 предложения.

Если блокеров и рисков нет — явно напиши об этом.
"""


def build_personal_digest_prompt(data: Dict[str, Any]) -> str:
    return f"""
Тебе передали персональные данные одного участника команды разработки.

Данные:
{data}

Сформируй КОРОТКУЮ персональную сводку для разработчика.

Требования:
1. Дружелюбный, но нейтральный тон.
2. Без наставлений и давления.
3. Чётко и по делу.
4. Не более 6–8 строк.

Структура:

- **Твои задачи:** что в работе сейчас.
- **Блокеры:** если есть — что мешает.
- **Зависшие задачи:** если есть.
- **Напоминания:** что стоит сделать или проверить сегодня.

Если блокеров нет — напиши, что всё ок.
"""
